数据表格控件的渲染器
====

在第一部分中，我们讲述了如何实现一个最简单的数据表格控件，在这个部分，我们会讨论得深入一些，探讨数据表格的渲染器、排序等功能。

#5. 渲染器

什么叫做渲染器呢？

之前我们的DataGrid非常简单，每个单元格只是简单的把文本数据渲染出来，如果想要对这些文本作格式化处理，比如说，把性别的标记0和1转换成文字的“男”和“女”，要怎么去考虑？

有个笨办法，我们让用户传入数据之前，就把原始数据修改一下，比如说，原先数据格式是这样：

	{
		name: "Tom",
		gender: 1
	}

我们给他先转换一遍，变成：

	{
		name: "Tom",
		gender: 1,
		genderName: "Male"
	}

这样，不显示gender这个列，而是直接显示genderName这一列，也可以做到想要的效果。这么看上去简单方便，有没有什么弊端呢？有三种。

- 破坏了原始数据
- 需要对数据作预处理，这个处理过程比较集中，我们在前端常见的优化策略是把计算尽可能均摊，避免某个短时间的密集计算。
- 把逻辑割裂了。为什么这么说呢，因为你不但要在批量加载数据之前做这个转换，新增、修改行的时候，是不是也同时要？

另外也有个办法，可以预定义一些规则，比如说定义了这个是性别的列，把格式化的过程内置在控件中，这种做法也不好，内置的东西总是有限的，面对不断变更的需求，需要无休止地修改。

现在讨论的只是单个列需要处理，假如有多个，那更麻烦了，有没有什么更好的办法呢？

我们可以把这个格式化功能提取到外面，然后注入进来。格式化的功能，至少应当是针对列的，所以可以附加到列的初始化信息里传递过来。考虑一下格式化函数的参数，至少需要原始值，但有些情况更加复杂，所以我们多给它一些信息，比如说，本行的完整数据，还有当前列的key值。这么一来，一个典型的格式化函数就有了：

	function labelFunction(data, key) {
		var value = data[key];
		if (value == 0) {
			return "Female";
		}
		else {
			return "Male";
		}
	}